generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      String                  @id @default(cuid())
  email                   String                  @unique
  passwordHash            String
  firstName               String
  lastName                String
  phone                   String?
  role                    Role
  isActive                Boolean                 @default(true)
  lastLoginAt             DateTime?
  createdAt               DateTime                @default(now())
  updatedAt               DateTime                @updatedAt
  orgId                   String?
  company                 String?
  subscriptionPlan        SubscriptionPlan        @default(FREE_TRIAL)
  subscriptionStatus      SubscriptionStatus      @default(TRIAL)
  trialEndDate            DateTime?
  emailVerified           Boolean                 @default(false)
  assignedInspections     Inspection[]            @relation("AssignedTechnician")
  completedInspections    Inspection[]            @relation("CompletedBy")
  inspectionAuditLogs     InspectionAuditLog[]
  inspectionReminders     InspectionReminder[]
  uploadedAttachments     InspectionAttachment[] @relation("InspectionAttachmentUploadedBy")
  uploadedInspectionPhotos InspectionPhoto[]      @relation("InspectionPhotoUploadedBy")
  sentInvites             Invite[]                @relation("InvitedBy")
  receivedInvite          Invite?                 @relation("InvitedUser")
  assignedJobs            Job[]                   @relation("AssignedTechnician")
  createdJobs             Job[]                   @relation("CreatedJobs")
  jobComments             JobComment[]
  notifications           Notification[]
  OwnerProfile            OwnerProfile?
  managedProperties       Property[]              @relation("PropertyManager")
  PropertyManagerProfile  PropertyManagerProfile?
  ownedProperties         PropertyOwner[]
  approvedRecommendations Recommendation[]        @relation("ApprovedBy")
  createdRecommendations  Recommendation[]        @relation("CreatedBy")
  requestedServiceRequests ServiceRequest[]       @relation("RequestedBy")
  approvedServiceRequests  ServiceRequest[]       @relation("ApprovedRequests")
  rejectedServiceRequests  ServiceRequest[]       @relation("RejectedRequests")
  reviewedServiceRequests  ServiceRequest[]       @relation("ReviewedRequests")
  subscriptions           Subscription[]
  TechnicianProfile       TechnicianProfile?
  TenantProfile           TenantProfile?
  tenantUnits             UnitTenant[]
  unitOwners              UnitOwner[]             @relation("UnitOwners")
  reportRequests          ReportRequest[]         @relation("ReportRequestsCreated")
  passwordResets          PasswordReset[]
  auditLogs               AuditLog[]
  Org                     Org?                    @relation(fields: [orgId], references: [id])
  blogPosts               BlogPost[]
  uploadedPropertyDocuments PropertyDocument[]  @relation("PropertyDocumentUploader")
  propertyNotes           PropertyNote[]         @relation("PropertyNoteAuthor")

  @@index([email])
  @@index([role])
}

model PasswordReset {
  id        String   @id @default(cuid())
  userId    String
  selector  String   @unique
  verifier  String
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([selector])
}

model Invite {
  id            String       @id @default(cuid())
  email         String
  role          Role
  token         String       @unique
  status        InviteStatus @default(PENDING)
  expiresAt     DateTime
  createdAt     DateTime     @default(now())
  invitedById   String
  invitedUserId String?      @unique
  propertyId    String?
  unitId        String?
  invitedBy     User         @relation("InvitedBy", fields: [invitedById], references: [id], onDelete: Cascade)
  invitedUser   User?        @relation("InvitedUser", fields: [invitedUserId], references: [id])
  property      Property?    @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  unit          Unit?        @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([token])
  @@index([status])
}

model Subscription {
  id                     String             @id @default(cuid())
  userId                 String
  planId                 String
  planName               String
  status                 SubscriptionStatus @default(TRIAL)
  stripeCustomerId       String?            @unique
  stripeSubscriptionId   String?            @unique
  stripeCurrentPeriodEnd DateTime?
  trialStartDate         DateTime           @default(now())
  trialEndDate           DateTime?
  startDate              DateTime           @default(now())
  endDate                DateTime?
  cancelledAt            DateTime?
  createdAt              DateTime           @default(now())
  updatedAt              DateTime           @updatedAt
  user                   User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
}

model Property {
  id              String            @id @default(cuid())
  name            String
  address         String
  city            String
  state           String?
  zipCode         String?
  country         String            @default("USA")
  propertyType    String
  yearBuilt       Int?
  totalUnits      Int               @default(0)
  totalArea       Float?
  status          PropertyStatus    @default(ACTIVE)
  description     String?
  imageUrl        String?

  // Enhanced property details
  lotSize              Float?
  buildingSize         Float?
  numberOfFloors       Int?
  constructionType     String?
  heatingSystem        String?
  coolingSystem        String?
  amenities            Json?

  // Financial information
  purchasePrice        Float?
  purchaseDate         DateTime?
  currentMarketValue   Float?
  annualPropertyTax    Float?
  annualInsurance      Float?
  monthlyHOA           Float?

  propertyImages  PropertyImage[]
  propertyDocuments PropertyDocument[]
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  managerId       String
  inspections     Inspection[]
  invites         Invite[]
  jobs            Job[]
  plans           MaintenancePlan[]
  manager         User              @relation("PropertyManager", fields: [managerId], references: [id], onDelete: Cascade)
  owners          PropertyOwner[]
  reportRequests  ReportRequest[]
  serviceRequests ServiceRequest[]
  units           Unit[]
  propertyNotes   PropertyNote[]

  @@index([managerId])
  @@index([status])
  @@index([city, state])
}

model PropertyImage {
  id           String   @id @default(cuid())
  propertyId   String
  imageUrl     String
  caption      String?
  isPrimary    Boolean  @default(false)
  displayOrder Int      @default(0)
  uploadedById String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@index([displayOrder])
}

model PropertyDocument {
  id          String                      @id @default(cuid())
  propertyId  String
  unitId      String?                     // Optional: if null, belongs to property
  fileName    String
  fileUrl     String
  fileSize    Int
  mimeType    String
  category    PropertyDocumentCategory
  description String?
  accessLevel PropertyDocumentAccessLevel
  uploaderId  String
  uploadedAt  DateTime                    @default(now())
  updatedAt   DateTime                    @updatedAt

  property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  unit     Unit?    @relation(fields: [unitId], references: [id], onDelete: Cascade)
  uploader User     @relation("PropertyDocumentUploader", fields: [uploaderId], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@index([unitId])
  @@index([uploaderId])
  @@index([category])
  @@index([accessLevel])
}

model PropertyNote {
  id          String   @id @default(cuid())
  propertyId  String
  authorId    String
  content     String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  author   User     @relation("PropertyNoteAuthor", fields: [authorId], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@index([authorId])
}

model UnitImage {
  id           String   @id @default(cuid())
  unitId       String
  imageUrl     String
  caption      String?
  isPrimary    Boolean  @default(false)
  displayOrder Int      @default(0)
  uploadedById String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  unit Unit @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([unitId])
  @@index([displayOrder])
}

model PropertyOwner {
  id                  String    @id @default(cuid())
  propertyId          String
  ownerId             String
  ownershipPercentage Float     @default(100.0)
  startDate           DateTime  @default(now())
  endDate             DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  owner               User      @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  property            Property  @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@unique([propertyId, ownerId])
  @@index([propertyId])
  @@index([ownerId])
}

model Unit {
  id              String             @id @default(cuid())
  unitNumber      String
  propertyId      String
  floor           Int?
  bedrooms        Int?
  bathrooms       Float?
  area            Float?
  rentAmount      Float?
  status          UnitStatus         @default(AVAILABLE)
  description     String?
  imageUrl        String?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  inspections     Inspection[]
  invites         Invite[]
  jobs            Job[]
  reportRequests  ReportRequest[]
  serviceRequests ServiceRequest[]
  property        Property           @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  tenants         UnitTenant[]
  owners          UnitOwner[]
  unitImages      UnitImage[]
  documents       PropertyDocument[]

  @@unique([propertyId, unitNumber])
  @@index([propertyId])
  @@index([status])
}

model UnitTenant {
  id            String   @id @default(cuid())
  unitId        String
  tenantId      String
  leaseStart    DateTime
  leaseEnd      DateTime
  rentAmount    Float
  depositAmount Float?
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  tenant        User     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  unit          Unit     @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([unitId])
  @@index([tenantId])
  @@index([isActive])
}

model UnitOwner {
  id                  String    @id @default(cuid())
  unitId              String
  ownerId             String
  ownershipPercentage Float     @default(100.0)
  startDate           DateTime  @default(now())
  endDate             DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  owner               User      @relation("UnitOwners", fields: [ownerId], references: [id], onDelete: Cascade)
  unit                Unit      @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@unique([unitId, ownerId])
  @@index([unitId])
  @@index([ownerId])
}

model Inspection {
  id              String            @id @default(cuid())
  title           String
  type            InspectionType
  scheduledDate   DateTime
  completedDate   DateTime?
  propertyId      String
  unitId          String?
  assignedToId    String?
  completedById   String?
  status          InspectionStatus  @default(SCHEDULED)
  notes           String?
  findings        String?
  tenantSignature String?
  tags            String[]          @default([])
  photos          String[]          @default([])
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  assignedTo      User?             @relation("AssignedTechnician", fields: [assignedToId], references: [id])
  completedBy     User?             @relation("CompletedBy", fields: [completedById], references: [id])
  property        Property          @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  unit            Unit?             @relation(fields: [unitId], references: [id], onDelete: Cascade)
  attachments     InspectionAttachment[]
  auditLogs       InspectionAuditLog[]
  reminders       InspectionReminder[]
  jobs            Job[]
  report          Report?
  rooms           InspectionRoom[]
  inspectionIssues InspectionIssue[]
  inspectionPhotos InspectionPhoto[]

  @@index([propertyId])
  @@index([unitId])
  @@index([assignedToId])
  @@index([status])
  @@index([scheduledDate])
}

model Job {
  id                String           @id @default(cuid())
  title             String
  description       String
  priority          JobPriority      @default(MEDIUM)
  status            JobStatus        @default(OPEN)
  propertyId        String?
  unitId            String?
  assignedToId      String?
  createdById       String
  serviceRequestId  String?
  maintenancePlanId String?
  inspectionId      String?
  scheduledDate     DateTime?
  startedAt         DateTime?
  completedDate     DateTime?
  estimatedCost     Float?
  actualCost        Float?
  evidence          Json?
  notes             String?
  technicianNotes   String?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  createdBy         User             @relation("CreatedJobs", fields: [createdById], references: [id])
  assignedTo        User?            @relation("AssignedTechnician", fields: [assignedToId], references: [id])
  Inspection        Inspection?      @relation(fields: [inspectionId], references: [id])
  maintenancePlan   MaintenancePlan? @relation(fields: [maintenancePlanId], references: [id])
  property          Property?        @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  serviceRequest    ServiceRequest?  @relation(fields: [serviceRequestId], references: [id])
  unit              Unit?            @relation(fields: [unitId], references: [id], onDelete: Cascade)
  comments          JobComment[]

  @@index([propertyId])
  @@index([unitId])
  @@index([assignedToId])
  @@index([createdById])
  @@index([status])
  @@index([priority])
  @@index([scheduledDate])
  @@index([inspectionId])
}

model MaintenancePlan {
  id                String    @id @default(cuid())
  name              String
  description       String?
  propertyId        String
  frequency         String
  nextDueDate       DateTime
  lastCompletedDate DateTime?
  autoCreateJobs    Boolean   @default(false)
  isActive          Boolean   @default(true)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  jobs              Job[]
  property          Property  @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@index([isActive])
  @@index([nextDueDate])
}

model ServiceRequest {
  id                     String                 @id @default(cuid())
  title                  String
  description            String
  category               ServiceRequestCategory
  priority               JobPriority            @default(MEDIUM)
  status                 ServiceRequestStatus   @default(SUBMITTED)
  propertyId             String
  unitId                 String?
  requestedById          String
  photos                 String[]               @default([])
  reviewNotes            String?
  reviewedAt             DateTime?

  // New fields for budget and approval workflow
  ownerEstimatedBudget   Float?
  managerEstimatedCost   Float?
  approvedBudget         Float?
  costBreakdownNotes     String?

  approvedById           String?
  approvedAt             DateTime?
  rejectedById           String?
  rejectedAt             DateTime?
  rejectionReason        String?

  lastReviewedById       String?
  lastReviewedAt         DateTime?

  createdAt              DateTime               @default(now())
  updatedAt              DateTime               @updatedAt

  jobs                   Job[]
  property               Property               @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  requestedBy            User                   @relation("RequestedBy", fields: [requestedById], references: [id], onDelete: Cascade)
  approvedBy             User?                  @relation("ApprovedRequests", fields: [approvedById], references: [id])
  rejectedBy             User?                  @relation("RejectedRequests", fields: [rejectedById], references: [id])
  lastReviewedBy         User?                  @relation("ReviewedRequests", fields: [lastReviewedById], references: [id])
  unit                   Unit?                  @relation(fields: [unitId], references: [id])

  @@index([propertyId])
  @@index([unitId])
  @@index([requestedById])
  @@index([approvedById])
  @@index([rejectedById])
  @@index([status])
  @@index([category])
}

model Report {
  id              String           @id @default(cuid())
  title           String
  inspectionId    String           @unique
  summary         String
  findings        String
  pdfUrl          String?
  data            Json?
  generatedDate   DateTime         @default(now())
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  recommendations Recommendation[]
  inspection      Inspection       @relation(fields: [inspectionId], references: [id], onDelete: Cascade)

  @@index([inspectionId])
  @@index([generatedDate])
}

model ReportRequest {
  id              String   @id @default(cuid())
  reportType      String
  parameters      Json?
  propertyId      String
  unitId          String?
  requestedById   String
  status          String   @default("PENDING")
  fileUrl         String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  property        Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  unit            Unit?    @relation(fields: [unitId], references: [id])
  requestedBy     User     @relation("ReportRequestsCreated", fields: [requestedById], references: [id])
  
  @@index([propertyId])
  @@index([unitId])
  @@index([requestedById])
  @@index([status])
}

model Recommendation {
  id              String               @id @default(cuid())
  title           String
  description     String
  reportId        String
  estimatedCost   Float?
  priority        JobPriority          @default(MEDIUM)
  status          RecommendationStatus @default(DRAFT)
  createdById     String
  approvedById    String?
  approvedAt      DateTime?
  implementedAt   DateTime?
  rejectionReason String?
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  approvedBy      User?                @relation("ApprovedBy", fields: [approvedById], references: [id])
  createdBy       User                 @relation("CreatedBy", fields: [createdById], references: [id], onDelete: Cascade)
  report          Report               @relation(fields: [reportId], references: [id], onDelete: Cascade)

  @@index([reportId])
  @@index([status])
  @@index([createdById])
}

model Notification {
  id         String           @id @default(cuid())
  userId     String
  type       NotificationType
  title      String
  message    String
  isRead     Boolean          @default(false)
  readAt     DateTime?
  entityType String?
  entityId   String?
  createdAt  DateTime         @default(now())
  user       User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@index([createdAt])
}

model InspectionAttachment {
  id            String      @id @default(cuid())
  inspectionId  String
  name          String      @map("fileName")
  mimeType      String      @map("fileType")
  url           String      @map("fileUrl")
  size          Int?
  annotations   Json?
  uploadedById  String?
  createdAt     DateTime    @default(now()) @map("uploadedAt")
  inspection    Inspection  @relation(fields: [inspectionId], references: [id], onDelete: Cascade)
  uploadedBy    User?       @relation("InspectionAttachmentUploadedBy", fields: [uploadedById], references: [id])

  @@index([inspectionId])
}

model InspectionAuditLog {
  id           String     @id @default(cuid())
  action       String
  changes      Json?
  createdAt    DateTime   @default(now()) @map("timestamp")
  inspectionId String
  userId       String?
  inspection   Inspection @relation(fields: [inspectionId], references: [id], onDelete: Cascade)
  user         User?      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([inspectionId])
  @@index([createdAt])
  @@index([userId])
}

model InspectionReminder {
  id           String     @id @default(cuid())
  inspectionId String
  remindAt     DateTime   @map("reminderDate")
  sentAt       DateTime?
  channel      String
  recipients   String[]   @default([])
  metadata     Json?
  createdById  String     @map("userId")
  inspection   Inspection @relation(fields: [inspectionId], references: [id], onDelete: Cascade)
  createdBy    User       @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@index([inspectionId])
  @@index([remindAt])
  @@index([createdById])
}

model InspectionRoom {
  id              String                    @id @default(cuid())
  inspectionId    String
  name            String
  roomType        RoomType?
  notes           String?
  order           Int                       @default(0)
  createdAt       DateTime                  @default(now())
  updatedAt       DateTime                  @updatedAt
  inspection      Inspection                @relation(fields: [inspectionId], references: [id], onDelete: Cascade)
  checklistItems  InspectionChecklistItem[]
  issues          InspectionIssue[]
  photos          InspectionPhoto[]

  @@index([inspectionId])
}

model InspectionChecklistItem {
  id          String               @id @default(cuid())
  roomId      String
  description String
  status      ChecklistItemStatus  @default(PENDING)
  notes       String?
  order       Int                  @default(0)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  room        InspectionRoom       @relation(fields: [roomId], references: [id], onDelete: Cascade)
  issues      InspectionIssue[]

  @@index([roomId])
}

model InspectionIssue {
  id              String                   @id @default(cuid())
  inspectionId    String
  roomId          String?
  checklistItemId String?
  title           String
  description     String?
  severity        IssueSeverity            @default(MEDIUM)
  status          IssueStatus              @default(OPEN)
  createdAt       DateTime                 @default(now())
  updatedAt       DateTime                 @updatedAt
  inspection      Inspection               @relation(fields: [inspectionId], references: [id], onDelete: Cascade)
  room            InspectionRoom?          @relation(fields: [roomId], references: [id], onDelete: Cascade)
  checklistItem   InspectionChecklistItem? @relation(fields: [checklistItemId], references: [id], onDelete: SetNull)
  photos          InspectionPhoto[]

  @@index([inspectionId])
  @@index([roomId])
  @@index([checklistItemId])
}

model InspectionPhoto {
  id           String           @id @default(cuid())
  inspectionId String
  roomId       String?
  issueId      String?
  url          String
  caption      String?
  order        Int              @default(0)
  uploadedById String?
  createdAt    DateTime         @default(now())
  inspection   Inspection       @relation(fields: [inspectionId], references: [id], onDelete: Cascade)
  room         InspectionRoom?  @relation(fields: [roomId], references: [id], onDelete: Cascade)
  issue        InspectionIssue? @relation(fields: [issueId], references: [id], onDelete: Cascade)
  uploadedBy   User?            @relation("InspectionPhotoUploadedBy", fields: [uploadedById], references: [id])

  @@index([inspectionId])
  @@index([roomId])
  @@index([issueId])
}

model Org {
  id        String   @id
  name      String
  createdAt DateTime @default(now())
  User      User[]
}

model OwnerProfile {
  id     String @id
  userId String @unique
  User   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model PropertyManagerProfile {
  id                String   @id
  userId            String   @unique
  managedProperties Json?
  permissions       Json?
  createdAt         DateTime @default(now())
  updatedAt         DateTime
  User              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model TechnicianProfile {
  id     String @id
  userId String @unique
  User   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model TenantProfile {
  id     String @id
  userId String @unique
  User   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum Role {
  PROPERTY_MANAGER
  OWNER
  TENANT
  TECHNICIAN
  ADMIN
}

enum SubscriptionStatus {
  TRIAL
  ACTIVE
  PENDING
  SUSPENDED
  CANCELLED
}

enum PropertyStatus {
  ACTIVE
  INACTIVE
  UNDER_MAINTENANCE
}

enum UnitStatus {
  AVAILABLE
  OCCUPIED
  MAINTENANCE
  VACANT
  PENDING_MOVE_IN
  PENDING_MOVE_OUT
}

enum InviteStatus {
  PENDING
  ACCEPTED
  EXPIRED
}

enum InspectionStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum InspectionType {
  ROUTINE
  MOVE_IN
  MOVE_OUT
  EMERGENCY
  COMPLIANCE
}

enum RoomType {
  BEDROOM
  BATHROOM
  KITCHEN
  LIVING_ROOM
  DINING_ROOM
  HALLWAY
  LAUNDRY_ROOM
  GARAGE
  BASEMENT
  ATTIC
  BALCONY
  PATIO
  STORAGE
  OFFICE
  OTHER
}

enum ChecklistItemStatus {
  PENDING
  PASSED
  FAILED
  NA
}

enum IssueSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum IssueStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum JobStatus {
  OPEN
  ASSIGNED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum JobPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ServiceRequestStatus {
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  CONVERTED_TO_JOB
  REJECTED
  COMPLETED
  PENDING_MANAGER_REVIEW
  PENDING_OWNER_APPROVAL
  APPROVED_BY_OWNER
  REJECTED_BY_OWNER
}

enum ServiceRequestCategory {
  PLUMBING
  ELECTRICAL
  HVAC
  APPLIANCE
  STRUCTURAL
  PEST_CONTROL
  LANDSCAPING
  GENERAL
  OTHER
}

enum RecommendationStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  REJECTED
  IMPLEMENTED
}

enum NotificationType {
  INSPECTION_SCHEDULED
  INSPECTION_REMINDER
  JOB_ASSIGNED
  JOB_COMPLETED
  SERVICE_REQUEST_UPDATE
  SUBSCRIPTION_EXPIRING
  PAYMENT_DUE
  SYSTEM
}

enum SubscriptionPlan {
  FREE_TRIAL
  STARTER
  PROFESSIONAL
  ENTERPRISE
}

model JobComment {
  id        String   @id @default(cuid())
  jobId     String
  userId    String
  content   String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  job       Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id])

  @@index([jobId])
  @@index([userId])
  @@index([createdAt])
}

model AuditLog {
  id         String   @id @default(cuid())
  entityType String
  entityId   String
  action     String
  userId     String
  changes    Json?
  metadata   Json?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())

  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([entityType, entityId])
  @@index([userId])
  @@index([action])
  @@index([createdAt])
}

model BlogPost {
  id              String              @id @default(cuid())
  title           String
  slug            String              @unique
  excerpt         String?             @db.Text
  content         String              @db.Text
  htmlContent     String?             @db.Text
  coverImage      String?
  authorId        String
  status          BlogPostStatus      @default(DRAFT)
  featured        Boolean             @default(false)
  viewCount       Int                 @default(0)

  // SEO fields
  metaTitle       String?
  metaDescription String?             @db.Text
  metaKeywords    String[]            @default([])
  ogImage         String?

  publishedAt     DateTime?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  // Automation fields
  isAutomated        Boolean             @default(false)
  automationMetadata Json?

  author          User                @relation(fields: [authorId], references: [id], onDelete: Cascade)
  categories      BlogPostCategory[]
  tags            BlogPostTag[]
  media           BlogMedia[]

  @@index([slug])
  @@index([authorId])
  @@index([status])
  @@index([publishedAt])
  @@index([featured])
  @@index([isAutomated])
}

model BlogCategory {
  id          String              @id @default(cuid())
  name        String              @unique
  slug        String              @unique
  description String?             @db.Text
  color       String?
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt

  posts       BlogPostCategory[]

  @@index([slug])
}

model BlogTag {
  id          String              @id @default(cuid())
  name        String              @unique
  slug        String              @unique
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt

  posts       BlogPostTag[]

  @@index([slug])
}

model BlogPostCategory {
  id         String        @id @default(cuid())
  postId     String
  categoryId String

  post       BlogPost      @relation(fields: [postId], references: [id], onDelete: Cascade)
  category   BlogCategory  @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([postId, categoryId])
  @@index([postId])
  @@index([categoryId])
}

model BlogPostTag {
  id     String   @id @default(cuid())
  postId String
  tagId  String

  post   BlogPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  tag    BlogTag  @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([postId, tagId])
  @@index([postId])
  @@index([tagId])
}

model BlogMedia {
  id        String      @id @default(cuid())
  postId    String
  url       String
  type      MediaType
  caption   String?
  altText   String?
  size      Int?
  mimeType  String?
  order     Int         @default(0)
  createdAt DateTime    @default(now())

  post      BlogPost    @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@index([order])
}

enum BlogPostStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum MediaType {
  IMAGE
  VIDEO
  EMBED
}

enum PropertyDocumentCategory {
  LEASE_AGREEMENT
  INSURANCE
  PERMIT
  INSPECTION_REPORT
  MAINTENANCE_RECORD
  FINANCIAL
  LEGAL
  PHOTOS
  OTHER
}

enum PropertyDocumentAccessLevel {
  PUBLIC
  TENANT
  OWNER
  PROPERTY_MANAGER
}
