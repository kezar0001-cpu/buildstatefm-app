generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                                                   String                  @id @default(cuid())
  email                                                String                  @unique
  passwordHash                                         String
  firstName                                            String
  lastName                                             String
  phone                                                String?
  role                                                 Role
  isActive                                             Boolean                 @default(true)
  lastLoginAt                                          DateTime?
  createdAt                                            DateTime                @default(now())
  updatedAt                                            DateTime                @updatedAt
  orgId                                                String?
  company                                              String?
  subscriptionPlan                                     SubscriptionPlan        @default(FREE_TRIAL)
  subscriptionStatus                                   SubscriptionStatus      @default(TRIAL)
  trialEndDate                                         DateTime?
  emailVerified                                        Boolean                 @default(false)
  AuditLog                                             AuditLog[]
  BlogPost                                             BlogPost[]
  Inspection_Inspection_approvedByIdToUser             Inspection[]            @relation("Inspection_approvedByIdToUser")
  assignedInspections                                  Inspection[]            @relation("AssignedTechnician")
  completedInspections                                 Inspection[]            @relation("CompletedBy")
  Inspection_Inspection_rejectedByIdToUser             Inspection[]            @relation("Inspection_rejectedByIdToUser")
  InspectionAttachment                                 InspectionAttachment[]
  InspectionAuditLog                                   InspectionAuditLog[]
  InspectionPhoto                                      InspectionPhoto[]
  InspectionReminder                                   InspectionReminder[]
  sentInvites                                          Invite[]                @relation("InvitedBy")
  receivedInvite                                       Invite?                 @relation("InvitedUser")
  assignedJobs                                         Job[]                   @relation("AssignedTechnician")
  Job_Job_createdByIdToUser                            Job[]                   @relation("Job_createdByIdToUser")
  JobComment                                           JobComment[]
  RecommendationComment                                RecommendationComment[] @relation("RecommendationCommentUser")
  notifications                                        Notification[]
  OwnerProfile                                         OwnerProfile?
  PasswordReset                                        PasswordReset[]
  managedProperties                                    Property[]              @relation("PropertyManager")
  PropertyDocument                                     PropertyDocument[]
  PropertyManagerProfile                               PropertyManagerProfile?
  PropertyNote                                         PropertyNote[]
  ownedProperties                                      PropertyOwner[]
  approvedRecommendations                              Recommendation[]        @relation("ApprovedBy")
  createdRecommendations                               Recommendation[]        @relation("CreatedBy")
  RecurringInspection                                  RecurringInspection[]
  ReportRequest                                        ReportRequest[]
  ServiceRequest_ServiceRequest_approvedByIdToUser     ServiceRequest[]        @relation("ServiceRequest_approvedByIdToUser")
  ServiceRequest_ServiceRequest_lastReviewedByIdToUser ServiceRequest[]        @relation("ServiceRequest_lastReviewedByIdToUser")
  ServiceRequest_ServiceRequest_rejectedByIdToUser     ServiceRequest[]        @relation("ServiceRequest_rejectedByIdToUser")
  serviceRequests                                      ServiceRequest[]
  subscriptions                                        Subscription[]
  TechnicianProfile                                    TechnicianProfile?
  TenantProfile                                        TenantProfile?
  UnitOwner                                            UnitOwner[]
  tenantUnits                                          UnitTenant[]
  Org                                                  Org?                    @relation(fields: [orgId], references: [id])

  @@index([email])
  @@index([role])
}

model Invite {
  id            String       @id @default(cuid())
  email         String
  role          Role
  token         String       @unique
  status        InviteStatus @default(PENDING)
  expiresAt     DateTime
  createdAt     DateTime     @default(now())
  invitedById   String
  invitedUserId String?      @unique
  propertyId    String?
  unitId        String?
  invitedBy     User         @relation("InvitedBy", fields: [invitedById], references: [id], onDelete: Cascade)
  invitedUser   User?        @relation("InvitedUser", fields: [invitedUserId], references: [id])
  property      Property?    @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  unit          Unit?        @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([token])
  @@index([status])
}

model Subscription {
  id                     String             @id @default(cuid())
  userId                 String
  planId                 String
  planName               String
  status                 SubscriptionStatus @default(TRIAL)
  stripeCustomerId       String?            @unique
  stripeSubscriptionId   String?            @unique
  stripeCurrentPeriodEnd DateTime?
  trialStartDate         DateTime           @default(now())
  trialEndDate           DateTime?
  startDate              DateTime           @default(now())
  endDate                DateTime?
  cancelledAt            DateTime?
  createdAt              DateTime           @default(now())
  updatedAt              DateTime           @updatedAt
  user                   User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
}

model StripeWebhookEvent {
  id          String    @id @default(cuid())
  eventId     String    @unique
  eventType   String
  data        Json?
  processed   Boolean   @default(false)
  processedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model PromoCode {
  id                 String    @id @default(cuid())
  code               String    @unique
  description        String?
  discountType       String
  discountAmount     Float?
  discountPercentage Float?
  maxUses            Int?
  currentUses        Int       @default(0)
  expiresAt          DateTime?
  applicablePlans    String[]  @default([])
  isActive           Boolean   @default(true)
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  @@index([code])
  @@index([isActive])
}

model Property {
  id                  String                @id @default(cuid())
  name                String
  address             String
  city                String
  state               String?
  zipCode             String?
  country             String                @default("USA")
  propertyType        String
  yearBuilt           Int?
  totalUnits          Int                   @default(0)
  totalArea           Float?
  status              PropertyStatus        @default(ACTIVE)
  description         String?
  imageUrl            String?
  lotSize             Float?
  buildingSize        Float?
  numberOfFloors      Int?
  constructionType    String?
  heatingSystem       String?
  coolingSystem       String?
  amenities           Json?
  purchasePrice       Float?
  purchaseDate        DateTime?
  currentMarketValue  Float?
  annualPropertyTax   Float?
  annualInsurance     Float?
  monthlyHOA          Float?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  managerId           String
  inspections         Inspection[]
  InspectionTemplate  InspectionTemplate[]
  invites             Invite[]
  jobs                Job[]
  plans               MaintenancePlan[]
  manager             User                  @relation("PropertyManager", fields: [managerId], references: [id], onDelete: Cascade)
  PropertyDocument    PropertyDocument[]
  propertyImages      PropertyImage[]
  PropertyNote        PropertyNote[]
  owners              PropertyOwner[]
  recommendations     Recommendation[]
  RecurringInspection RecurringInspection[]
  ReportRequest       ReportRequest[]
  serviceRequests     ServiceRequest[]
  units               Unit[]

  @@index([managerId])
  @@index([status])
  @@index([city, state])
  @@index([managerId, status])
  @@index([status], map: "idx_property_status")
}

model PropertyImage {
  id           String                @id @default(cuid())
  propertyId   String
  imageUrl     String
  caption      String?
  isPrimary    Boolean               @default(false)
  displayOrder Int                   @default(0)
  uploadedById String?
  createdAt    DateTime              @default(now())
  updatedAt    DateTime              @updatedAt
  category     PropertyImageCategory @default(OTHER)
  property     Property              @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@index([displayOrder])
  @@index([category])
}

model PropertyOwner {
  id                  String    @id @default(cuid())
  propertyId          String
  ownerId             String
  ownershipPercentage Float     @default(100.0)
  startDate           DateTime  @default(now())
  endDate             DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  owner               User      @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  property            Property  @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@unique([propertyId, ownerId])
  @@index([propertyId])
  @@index([ownerId])
}

model Unit {
  id                  String                @id @default(cuid())
  unitNumber          String
  propertyId          String
  floor               Int?
  bedrooms            Int?
  bathrooms           Float?
  area                Float?
  rentAmount          Float?
  status              UnitStatus            @default(AVAILABLE)
  description         String?
  imageUrl            String?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  inspections         Inspection[]
  invites             Invite[]
  jobs                Job[]
  PropertyDocument    PropertyDocument[]
  RecurringInspection RecurringInspection[]
  ReportRequest       ReportRequest[]
  serviceRequests     ServiceRequest[]
  property            Property              @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  UnitImage           UnitImage[]
  UnitOwner           UnitOwner[]
  tenants             UnitTenant[]

  @@unique([propertyId, unitNumber])
  @@index([propertyId])
  @@index([status])
  @@index([propertyId, status])
  @@index([propertyId, status], map: "idx_unit_property_status")
}

model UnitTenant {
  id            String   @id @default(cuid())
  unitId        String
  tenantId      String
  leaseStart    DateTime
  leaseEnd      DateTime
  rentAmount    Float
  depositAmount Float?
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  tenant        User     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  unit          Unit     @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([unitId])
  @@index([tenantId])
  @@index([isActive])
  @@index([tenantId, isActive])
  @@index([unitId], map: "idx_unit_tenant_unit")
}

model Inspection {
  id                                 String                 @id @default(cuid())
  title                              String
  type                               InspectionType
  scheduledDate                      DateTime
  completedDate                      DateTime?
  propertyId                         String
  unitId                             String?
  assignedToId                       String?
  completedById                      String?
  status                             InspectionStatus       @default(SCHEDULED)
  notes                              String?
  findings                           String?
  tags                               String[]               @default([])
  photos                             String[]               @default([])
  createdAt                          DateTime               @default(now())
  updatedAt                          DateTime               @updatedAt
  rejectionReason                    String?
  rejectedById                       String?
  rejectedAt                         DateTime?
  approvedById                       String?
  approvedAt                         DateTime?
  templateId                         String?
  recurringInspectionId              String?
  tenantSignature                    String?
  User_Inspection_approvedByIdToUser User?                  @relation("Inspection_approvedByIdToUser", fields: [approvedById], references: [id])
  assignedTo                         User?                  @relation("AssignedTechnician", fields: [assignedToId], references: [id])
  completedBy                        User?                  @relation("CompletedBy", fields: [completedById], references: [id])
  property                           Property               @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  RecurringInspection                RecurringInspection?   @relation(fields: [recurringInspectionId], references: [id])
  User_Inspection_rejectedByIdToUser User?                  @relation("Inspection_rejectedByIdToUser", fields: [rejectedById], references: [id])
  InspectionTemplate                 InspectionTemplate?    @relation(fields: [templateId], references: [id])
  unit                               Unit?                  @relation(fields: [unitId], references: [id], onDelete: Cascade)
  InspectionAttachment               InspectionAttachment[]
  InspectionAuditLog                 InspectionAuditLog[]
  InspectionIssue                    InspectionIssue[]
  InspectionPhoto                    InspectionPhoto[]
  InspectionReminder                 InspectionReminder[]
  InspectionRoom                     InspectionRoom[]
  Job                                Job[]
  report                             Report?

  @@index([propertyId])
  @@index([unitId])
  @@index([assignedToId])
  @@index([status])
  @@index([scheduledDate])
  @@index([approvedById])
  @@index([propertyId, status, scheduledDate])
  @@index([recurringInspectionId])
  @@index([rejectedById])
  @@index([templateId])
  @@index([propertyId, status], map: "idx_inspection_property_status")
  @@index([assignedToId, status])
  @@index([scheduledDate, status])
}

model Job {
  id                         String           @id @default(cuid())
  title                      String
  description                String
  priority                   JobPriority      @default(MEDIUM)
  status                     JobStatus        @default(OPEN)
  propertyId                 String?
  unitId                     String?
  assignedToId               String?
  createdById                String
  serviceRequestId           String?
  maintenancePlanId          String?
  inspectionId               String?
  scheduledDate              DateTime?
  startedAt                  DateTime?
  completedDate              DateTime?
  estimatedCost              Float?
  actualCost                 Float?
  evidence                   Json?
  notes                      String?
  technicianNotes            String?
  createdAt                  DateTime         @default(now())
  updatedAt                  DateTime         @updatedAt
  assignedTo                 User?            @relation("AssignedTechnician", fields: [assignedToId], references: [id])
  User_Job_createdByIdToUser User             @relation("Job_createdByIdToUser", fields: [createdById], references: [id])
  Inspection                 Inspection?      @relation(fields: [inspectionId], references: [id])
  maintenancePlan            MaintenancePlan? @relation(fields: [maintenancePlanId], references: [id])
  property                   Property?        @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  serviceRequest             ServiceRequest?  @relation(fields: [serviceRequestId], references: [id])
  unit                       Unit?            @relation(fields: [unitId], references: [id], onDelete: Cascade)
  JobComment                 JobComment[]

  @@index([propertyId])
  @@index([unitId])
  @@index([assignedToId])
  @@index([status])
  @@index([priority])
  @@index([scheduledDate])
  @@index([createdById])
  @@index([inspectionId])
  @@index([propertyId, status])
  @@index([propertyId, status], map: "idx_job_property_status")
  @@index([assignedToId, status])
  @@index([scheduledDate, status])
  @@index([createdAt, status])
}

model MaintenancePlan {
  id                String    @id @default(cuid())
  name              String
  description       String?
  propertyId        String
  frequency         String
  nextDueDate       DateTime
  lastCompletedDate DateTime?
  autoCreateJobs    Boolean   @default(false)
  isActive          Boolean   @default(true)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  jobs              Job[]
  property          Property  @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@index([isActive])
  @@index([nextDueDate])
}

model ServiceRequest {
  id                                         String                 @id @default(cuid())
  title                                      String
  description                                String
  category                                   ServiceRequestCategory
  priority                                   JobPriority            @default(MEDIUM)
  status                                     ServiceRequestStatus   @default(SUBMITTED)
  propertyId                                 String
  unitId                                     String?
  requestedById                              String
  photos                                     String[]               @default([])
  reviewNotes                                String?
  reviewedAt                                 DateTime?
  ownerEstimatedBudget                       Float?
  managerEstimatedCost                       Float?
  approvedBudget                             Float?
  costBreakdownNotes                         String?
  approvedById                               String?
  approvedAt                                 DateTime?
  rejectedById                               String?
  rejectedAt                                 DateTime?
  rejectionReason                            String?
  lastReviewedById                           String?
  lastReviewedAt                             DateTime?
  archivedAt                                 DateTime?
  createdAt                                  DateTime               @default(now())
  updatedAt                                  DateTime               @updatedAt
  jobs                                       Job[]
  User_ServiceRequest_approvedByIdToUser     User?                  @relation("ServiceRequest_approvedByIdToUser", fields: [approvedById], references: [id])
  User_ServiceRequest_lastReviewedByIdToUser User?                  @relation("ServiceRequest_lastReviewedByIdToUser", fields: [lastReviewedById], references: [id])
  property                                   Property               @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  User_ServiceRequest_rejectedByIdToUser     User?                  @relation("ServiceRequest_rejectedByIdToUser", fields: [rejectedById], references: [id])
  requestedBy                                User                   @relation(fields: [requestedById], references: [id], onDelete: Cascade)
  unit                                       Unit?                  @relation(fields: [unitId], references: [id])

  @@index([propertyId])
  @@index([unitId])
  @@index([requestedById])
  @@index([status])
  @@index([category])
  @@index([approvedById])
  @@index([propertyId, status])
  @@index([rejectedById])
  @@index([propertyId, status], map: "idx_service_request_property_status")
  @@index([requestedById, status])
  @@index([category, status])
  @@index([createdAt, status])
}

model Report {
  id              String           @id @default(cuid())
  title           String
  inspectionId    String           @unique
  summary         String
  findings        String
  pdfUrl          String?
  data            Json?
  generatedDate   DateTime         @default(now())
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  recommendations Recommendation[]
  inspection      Inspection       @relation(fields: [inspectionId], references: [id], onDelete: Cascade)

  @@index([inspectionId])
  @@index([generatedDate])
}

model Recommendation {
  id              String               @id @default(cuid())
  title           String
  description     String
  reportId        String?
  estimatedCost   Float?
  priority        JobPriority          @default(MEDIUM)
  status          RecommendationStatus @default(DRAFT)
  createdById     String
  approvedById    String?
  approvedAt      DateTime?
  implementedAt   DateTime?
  rejectionReason String?
  managerResponse String?
  managerResponseAt DateTime?
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  propertyId      String
  rejectedAt      DateTime?
  approvedBy      User?                @relation("ApprovedBy", fields: [approvedById], references: [id])
  createdBy       User                 @relation("CreatedBy", fields: [createdById], references: [id], onDelete: Cascade)
  property        Property             @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  report          Report?              @relation(fields: [reportId], references: [id], onDelete: Cascade)

  comments       RecommendationComment[]

  @@index([reportId])
  @@index([propertyId])
  @@index([status])
  @@index([createdById])
  @@index([rejectedAt])
  @@index([propertyId, status])
  @@index([createdAt, status])
}

model RecommendationComment {
  id        String   @id @default(cuid())
  recommendationId String
  userId    String
  content   String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  recommendation Recommendation @relation(fields: [recommendationId], references: [id], onDelete: Cascade)
  user      User     @relation("RecommendationCommentUser", fields: [userId], references: [id])

  @@index([recommendationId])
  @@index([userId])
  @@index([createdAt])
}

model Notification {
  id         String           @id @default(cuid())
  userId     String
  type       NotificationType
  title      String
  message    String
  isRead     Boolean          @default(false)
  readAt     DateTime?
  entityType String?
  entityId   String?
  createdAt  DateTime         @default(now())
  user       User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@index([createdAt])
  @@index([entityType, entityId], map: "idx_notification_entity")
  @@index([userId, isRead, createdAt])
}

model AuditLog {
  id         String   @id
  entityType String
  entityId   String
  action     String
  userId     String
  changes    Json?
  metadata   Json?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())
  User       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([action])
  @@index([createdAt])
  @@index([entityType, entityId])
  @@index([userId])
}

model BlogCategory {
  id               String             @id
  name             String             @unique
  slug             String             @unique
  description      String?
  color            String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  BlogPostCategory BlogPostCategory[]

  @@index([slug])
}

model BlogMedia {
  id        String    @id
  postId    String
  url       String
  type      MediaType
  caption   String?
  altText   String?
  size      Int?
  mimeType  String?
  order     Int       @default(0)
  createdAt DateTime  @default(now())
  BlogPost  BlogPost  @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([order])
  @@index([postId])
}

model BlogPost {
  id                 String             @id
  title              String
  slug               String             @unique
  excerpt            String?
  content            String
  htmlContent        String?
  coverImage         String?
  authorId           String
  status             BlogPostStatus     @default(DRAFT)
  featured           Boolean            @default(false)
  viewCount          Int                @default(0)
  metaTitle          String?
  metaDescription    String?
  metaKeywords       String[]           @default([])
  ogImage            String?
  publishedAt        DateTime?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime
  isAutomated        Boolean            @default(false)
  automationMetadata Json?
  BlogMedia          BlogMedia[]
  User               User               @relation(fields: [authorId], references: [id], onDelete: Cascade)
  BlogPostCategory   BlogPostCategory[]
  BlogPostTag        BlogPostTag[]

  @@index([authorId])
  @@index([featured])
  @@index([isAutomated])
  @@index([publishedAt])
  @@index([slug])
  @@index([status])
}

model BlogPostCategory {
  id           String       @id
  postId       String
  categoryId   String
  BlogCategory BlogCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  BlogPost     BlogPost     @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([postId, categoryId])
  @@index([categoryId])
  @@index([postId])
}

model BlogPostTag {
  id       String   @id
  postId   String
  tagId    String
  BlogPost BlogPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  BlogTag  BlogTag  @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([postId, tagId])
  @@index([postId])
  @@index([tagId])
}

model BlogTag {
  id          String        @id
  name        String        @unique
  slug        String        @unique
  createdAt   DateTime      @default(now())
  updatedAt   DateTime
  BlogPostTag BlogPostTag[]

  @@index([slug])
}

model InspectionAttachment {
  id           String     @id
  inspectionId String
  fileName     String
  fileType     String
  fileUrl      String
  size         Int?
  annotations  Json?
  uploadedById String?
  uploadedAt   DateTime   @default(now())
  Inspection   Inspection @relation(fields: [inspectionId], references: [id], onDelete: Cascade)
  User         User?      @relation(fields: [uploadedById], references: [id])

  @@index([inspectionId])
}

model InspectionAuditLog {
  id           String     @id
  action       String
  changes      Json?
  timestamp    DateTime   @default(now())
  inspectionId String
  userId       String?
  Inspection   Inspection @relation(fields: [inspectionId], references: [id], onDelete: Cascade)
  User         User?      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([inspectionId])
  @@index([timestamp])
  @@index([userId])
}

model InspectionChecklistItem {
  id              String              @id
  roomId          String
  description     String
  status          ChecklistItemStatus @default(PENDING)
  notes           String?
  order           Int                 @default(0)
  createdAt       DateTime            @default(now())
  updatedAt       DateTime
  InspectionRoom  InspectionRoom      @relation(fields: [roomId], references: [id], onDelete: Cascade)
  InspectionIssue InspectionIssue[]

  @@index([roomId])
}

model InspectionIssue {
  id                      String                   @id
  inspectionId            String
  roomId                  String?
  checklistItemId         String?
  title                   String
  description             String?
  severity                IssueSeverity            @default(MEDIUM)
  status                  IssueStatus              @default(OPEN)
  createdAt               DateTime                 @default(now())
  updatedAt               DateTime
  InspectionChecklistItem InspectionChecklistItem? @relation(fields: [checklistItemId], references: [id])
  Inspection              Inspection               @relation(fields: [inspectionId], references: [id], onDelete: Cascade)
  InspectionRoom          InspectionRoom?          @relation(fields: [roomId], references: [id], onDelete: Cascade)
  InspectionPhoto         InspectionPhoto[]

  @@index([checklistItemId])
  @@index([inspectionId])
  @@index([roomId])
}

model InspectionPhoto {
  id              String           @id
  inspectionId    String
  roomId          String?
  issueId         String?
  url             String
  caption         String?
  order           Int              @default(0)
  uploadedById    String?
  createdAt       DateTime         @default(now())
  Inspection      Inspection       @relation(fields: [inspectionId], references: [id], onDelete: Cascade)
  InspectionIssue InspectionIssue? @relation(fields: [issueId], references: [id], onDelete: Cascade)
  InspectionRoom  InspectionRoom?  @relation(fields: [roomId], references: [id], onDelete: Cascade)
  User            User?            @relation(fields: [uploadedById], references: [id])

  @@index([inspectionId])
  @@index([issueId])
  @@index([roomId])
}

model InspectionReminder {
  id           String     @id
  inspectionId String
  reminderDate DateTime
  sentAt       DateTime?
  channel      String
  recipients   String[]   @default([])
  metadata     Json?
  userId       String
  Inspection   Inspection @relation(fields: [inspectionId], references: [id], onDelete: Cascade)
  User         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([inspectionId])
  @@index([reminderDate])
  @@index([userId])
}

model InspectionRoom {
  id                      String                    @id
  inspectionId            String
  name                    String
  roomType                RoomType?
  notes                   String?
  order                   Int                       @default(0)
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  InspectionChecklistItem InspectionChecklistItem[]
  InspectionIssue         InspectionIssue[]
  InspectionPhoto         InspectionPhoto[]
  Inspection              Inspection                @relation(fields: [inspectionId], references: [id], onDelete: Cascade)

  @@index([inspectionId])
}

model InspectionTemplate {
  id                     String                   @id
  name                   String
  description            String?
  type                   InspectionType
  isDefault              Boolean                  @default(false)
  isActive               Boolean                  @default(true)
  createdById            String
  propertyId             String?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  Inspection             Inspection[]
  Property               Property?                @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  InspectionTemplateRoom InspectionTemplateRoom[]
  RecurringInspection    RecurringInspection[]

  @@index([isActive])
  @@index([propertyId])
  @@index([type])
}

model InspectionTemplateChecklistItem {
  id                     String                 @id
  roomId                 String
  description            String
  order                  Int                    @default(0)
  createdAt              DateTime               @default(now())
  updatedAt              DateTime
  InspectionTemplateRoom InspectionTemplateRoom @relation(fields: [roomId], references: [id], onDelete: Cascade)

  @@index([roomId])
}

model InspectionTemplateRoom {
  id                              String                            @id
  templateId                      String
  name                            String
  roomType                        RoomType?
  order                           Int                               @default(0)
  createdAt                       DateTime                          @default(now())
  updatedAt                       DateTime
  InspectionTemplateChecklistItem InspectionTemplateChecklistItem[]
  InspectionTemplate              InspectionTemplate                @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@index([templateId])
}

model JobComment {
  id        String   @id
  jobId     String
  userId    String
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime
  Job       Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  User      User     @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([jobId])
  @@index([userId])
}

model Org {
  id        String   @id
  name      String
  createdAt DateTime @default(now())
  User      User[]
}

model OwnerProfile {
  id     String @id
  userId String @unique
  User   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model PasswordReset {
  id        String    @id
  userId    String
  selector  String    @unique
  verifier  String
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime  @default(now())
  User      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([selector])
  @@index([userId])
}

model PropertyDocument {
  id          String                      @id
  propertyId  String
  fileName    String
  fileUrl     String
  fileSize    Int
  mimeType    String
  category    PropertyDocumentCategory
  description String?
  accessLevel PropertyDocumentAccessLevel
  uploaderId  String
  uploadedAt  DateTime                    @default(now())
  updatedAt   DateTime
  unitId      String?
  Property    Property                    @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  Unit        Unit?                       @relation(fields: [unitId], references: [id], onDelete: Cascade)
  User        User                        @relation(fields: [uploaderId], references: [id], onDelete: Cascade)

  @@index([accessLevel])
  @@index([category])
  @@index([propertyId])
  @@index([unitId])
  @@index([uploaderId])
  @@index([propertyId, accessLevel])
  @@index([unitId, accessLevel])
}

model PropertyManagerProfile {
  id                String   @id
  userId            String   @unique
  managedProperties Json?
  permissions       Json?
  createdAt         DateTime @default(now())
  updatedAt         DateTime
  User              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model PropertyNote {
  id         String   @id
  propertyId String
  authorId   String
  content    String
  createdAt  DateTime @default(now())
  updatedAt  DateTime
  User       User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  Property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([authorId])
  @@index([propertyId])
}

model RecurringInspection {
  id                 String              @id
  title              String
  type               InspectionType
  propertyId         String
  unitId             String?
  assignedToId       String?
  frequency          RecurrenceFrequency
  interval           Int                 @default(1)
  dayOfMonth         Int?
  dayOfWeek          Int?
  startDate          DateTime
  endDate            DateTime?
  nextDueDate        DateTime
  lastGeneratedDate  DateTime?
  isActive           Boolean             @default(true)
  templateId         String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime
  Inspection         Inspection[]
  User               User?               @relation(fields: [assignedToId], references: [id])
  Property           Property            @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  InspectionTemplate InspectionTemplate? @relation(fields: [templateId], references: [id])
  Unit               Unit?               @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([assignedToId])
  @@index([isActive])
  @@index([nextDueDate])
  @@index([propertyId])
  @@index([templateId])
  @@index([unitId])
}

model ReportRequest {
  id            String   @id
  reportType    String
  parameters    Json?
  propertyId    String
  unitId        String?
  requestedById String
  status        String   @default("PENDING")
  fileUrl       String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  Property      Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  User          User     @relation(fields: [requestedById], references: [id])
  Unit          Unit?    @relation(fields: [unitId], references: [id])

  @@index([propertyId])
  @@index([requestedById])
  @@index([status])
  @@index([unitId])
}

model TechnicianProfile {
  id     String @id
  userId String @unique
  User   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model TenantProfile {
  id     String @id
  userId String @unique
  User   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UnitImage {
  id           String   @id
  unitId       String
  imageUrl     String
  caption      String?
  isPrimary    Boolean  @default(false)
  displayOrder Int      @default(0)
  uploadedById String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  Unit         Unit     @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([displayOrder])
  @@index([unitId])
}

model UnitOwner {
  id                  String    @id
  unitId              String
  ownerId             String
  ownershipPercentage Float     @default(100.0)
  startDate           DateTime  @default(now())
  endDate             DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime
  User                User      @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  Unit                Unit      @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@unique([unitId, ownerId])
  @@index([ownerId])
  @@index([unitId])
}

enum Role {
  PROPERTY_MANAGER
  OWNER
  TENANT
  TECHNICIAN
  ADMIN
}

enum SubscriptionStatus {
  TRIAL
  ACTIVE
  PENDING
  SUSPENDED
  CANCELLED
}

enum PropertyStatus {
  ACTIVE
  INACTIVE
  UNDER_MAINTENANCE
}

enum UnitStatus {
  AVAILABLE
  OCCUPIED
  MAINTENANCE
  VACANT
  PENDING_MOVE_IN
  PENDING_MOVE_OUT
}

enum InviteStatus {
  PENDING
  ACCEPTED
  EXPIRED
}

enum InspectionStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  PENDING_APPROVAL
}

enum InspectionType {
  ROUTINE
  MOVE_IN
  MOVE_OUT
  EMERGENCY
  COMPLIANCE
}

enum JobStatus {
  OPEN
  ASSIGNED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum JobPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ServiceRequestStatus {
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  CONVERTED_TO_JOB
  REJECTED
  COMPLETED
  PENDING_MANAGER_REVIEW
  PENDING_OWNER_APPROVAL
  APPROVED_BY_OWNER
  REJECTED_BY_OWNER
  ARCHIVED
}

enum ServiceRequestCategory {
  PLUMBING
  ELECTRICAL
  HVAC
  APPLIANCE
  STRUCTURAL
  PEST_CONTROL
  LANDSCAPING
  GENERAL
  OTHER
}

enum RecommendationStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  REJECTED
  IMPLEMENTED
  ARCHIVED
}

enum NotificationType {
  INSPECTION_SCHEDULED
  INSPECTION_REMINDER
  JOB_ASSIGNED
  JOB_COMPLETED
  SERVICE_REQUEST_UPDATE
  SUBSCRIPTION_EXPIRING
  PAYMENT_DUE
  SYSTEM
}

enum BlogPostStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum ChecklistItemStatus {
  PENDING
  PASSED
  FAILED
  NA
}

enum IssueSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum IssueStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum MediaType {
  IMAGE
  VIDEO
  EMBED
}

enum PropertyDocumentAccessLevel {
  PUBLIC
  TENANT
  OWNER
  PROPERTY_MANAGER
}

enum PropertyDocumentCategory {
  LEASE_AGREEMENT
  INSURANCE
  PERMIT
  INSPECTION_REPORT
  MAINTENANCE_RECORD
  FINANCIAL
  LEGAL
  PHOTOS
  OTHER
}

enum PropertyImageCategory {
  EXTERIOR
  INTERIOR
  KITCHEN
  BATHROOM
  BEDROOM
  OTHER
}

enum RecurrenceFrequency {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
}

enum RoomType {
  BEDROOM
  BATHROOM
  KITCHEN
  LIVING_ROOM
  DINING_ROOM
  HALLWAY
  LAUNDRY_ROOM
  GARAGE
  BASEMENT
  ATTIC
  BALCONY
  PATIO
  STORAGE
  OFFICE
  OTHER
}

enum SubscriptionPlan {
  FREE_TRIAL
  STARTER
  PROFESSIONAL
  ENTERPRISE
  BASIC
}
